<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/cli.css"/>
    <!--<link rel="stylesheet" href="bower_components/primeui/themes/delta/theme.css" />-->
    <link rel="stylesheet" type="text/css" href="bower_components/font-awesome/css/font-awesome.css" />
    <link rel="stylesheet" href="bower_components/jquery-ui/themes/base/jquery-ui.css" />
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="bower_components/jquery-ui/jquery-ui.js"></script>
    <script type="text/javascript" src="bower_components/angular/angular.js"></script>
    <script type="text/javascript" src="bower_components/angular-resource/angular-resource.js"></script>
    <script type="text/javascript">
/*global angular*/
/*global $*/
angular
        .module("client", ["ngResource"])
        .constant("config", {
            value: 12,
            endPoint: "http://localhost:8080/mini/api/rest"
        })
        .config(["$resourceProvider", function($resourceProvider){
            "use strict";
            $resourceProvider.defaults.stripTrailingSlashes = false;
        }])
        .controller("indexController", ["$log", "$scope", "$resource", "config", function($log, $scope, $resource, config){
            "use strict";
            var queryResource = $resource(config.endPoint + "/binders/query", {}, {
                "query": { method: "POST", isArray: true }
            });
            $scope.binderQuery = {};

            $scope.query = function(){
                $log.log("querying:", angular.toJson($scope.binderQuery));
                $scope.results = queryResource.query($scope.binderQuery);
            };
        }])
        .directive("binderPanel", ["$log", "$resource", "config", function($log, $resource, config){
            "use strict";
            var binderResource = $resource(config.endPoint + "/binders/:binderId");
            return {
                restrict: "E",
                scope: {
                    binderId: "="
                },
                templateUrl: "partials/binder-panel.html",
                controller: ["$scope", function($scope){
                    "use strict";
                    $scope.$watch("binderId", function(){
                        $scope.model = binderResource.get({binderId: $scope.binderId}, function(model){
                            $scope.binder = model.binders[0];
                        });
                    });

                    $scope.docketMatch = function(binder){
                        return function(docket){
                            return docket.binderId === binder.id;
                        };
                    };

                    $scope.decisionMatch = function(docket){
                        return function(decision){
                            return decision.docketId === docket.id;
                        }
                    }
                }]
            };
        }])


    </script>
</head>
<body data-ng-app="client" data-ng-controller="indexController">
coucou {{coucou}}
<input type="text" data-ng-model="binderQuery.reference" placeholder="Reference"/>
<br/>
<button data-ng-click="query()">Query</button>
<br/>
results: {{results}}
<div data-ng-repeat="binderId in results">
    <binder-panel binder-id="binderId"></binder-panel>
</div>

</html>