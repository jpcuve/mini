<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/cli.css"/>
    <!--<link rel="stylesheet" href="bower_components/primeui/themes/delta/theme.css" />-->
    <link rel="stylesheet" type="text/css" href="bower_components/font-awesome/css/font-awesome.css" />
    <link rel="stylesheet" href="bower_components/jquery-ui/themes/base/jquery-ui.css" />
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="bower_components/jquery-ui/jquery-ui.js"></script>
    <script type="text/javascript" src="bower_components/angular/angular.js"></script>
    <script type="text/javascript" src="bower_components/angular-resource/angular-resource.js"></script>
    <script type="text/javascript">
/*global angular*/
/*global $*/
angular
        .module("client", ["ngResource"])
        .constant("config", {
            value: 12,
            endPoint: "http://localhost:8080/mini/api/rest"
        })
        .config(["$resourceProvider", function($resourceProvider){
            "use strict";
            $resourceProvider.defaults.stripTrailingSlashes = false;
        }])
        .controller("indexController", ["$log", "$scope", "$resource", "config", function($log, $scope, $resource, config){
            "use strict";
            var queryResource = $resource(config.endPoint + "/binders/query", {}, {
                "query": { method: "POST", isArray: true }
            });
            var binderResource = $resource(config.endPoint + "/binders/:binderIds");
            $scope.binderQuery = {};

            $scope.query = function(){
                $log.log("querying:", angular.toJson($scope.binderQuery));
                $scope.results = queryResource.query($scope.binderQuery, function(results){
                    binderResource.get({binderIds: results.join(",")}, function(model){
                        var binderMap = {}, docketMap = {};
                        // process model
                        $scope.binders = model.binders;
                        angular.forEach(model.binders, function(binder){
                            binderMap[binder.id] = binder;
                            binder.dockets = [];
                        });
                        angular.forEach(model.dockets, function(docket){
                            $log.log("binder id:", docket.binderId);
                            var binder;
                            docketMap[docket.id] = docket;
                            docket.decisions = [];
                            binder = binderMap[docket.binderId];
                            binder.dockets.push(docket);
                        });

                    });
                });
            };
        }])
        .directive("binderPanel", ["$log", "$resource", "config", function($log, $resource, config){
            "use strict";
            return {
                restrict: "E",
                scope: {
                    binder: "="
                },
                templateUrl: "partials/binder-panel.html"
            };
        }])


    </script>
</head>
<body data-ng-app="client" data-ng-controller="indexController">
coucou {{coucou}}
<input type="text" data-ng-model="binderQuery.reference" placeholder="Reference"/>
<br/>
<button data-ng-click="query()">Query</button>
<br/>
results: {{results}}
<div data-ng-repeat="binder in binders">
    <binder-panel binder="binder"></binder-panel>
</div>
</body>
</html>